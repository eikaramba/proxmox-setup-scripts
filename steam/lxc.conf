# ===== AMD GPU Passthrough Configuration =====
# PCI Address%3A 0000%3Ac1%3A00.0
# Using persistent by-path device names to ensure consistent mapping
# Allow access to cgroup devices (DRI and KFD)
# Mount DRI devices using persistent PCI paths
# Mount KFD device (ROCm compute interface - required for ROCm)
# Allow system-level capabilities for GPU drivers
# ===== End GPU Configuration =====
# Enable FUSE for Flatpaks inside Docker
# Enable TUN/TAP for networking (Optional but recommended)
# Enable UINPUT for Steam Controllers (CRITICAL)
# --- Input Device Passthrough ---
# Allow access to input subsystem
# Allow UINPUT (Mouse/Keyboard creation) - ID 10%3A223
# Allow UHID (Gamepad creation) - ID 10%3A239
arch: amd64
cores: 8
features: nesting=1
hostname: steam
memory: 8192
mp0: /root/proxmox-setup-scripts,mp=/root/proxmox-setup-scripts
net0: name=eth0,bridge=vmbr0,firewall=1,gw=192.168.178.1,hwaddr=BC:24:11:C1:29:5F,ip=192.168.178.211/24,type=veth
ostype: ubuntu
rootfs: local-lvm:vm-111-disk-0,size=160G
swap: 4096
tags: amd;docker;ollama
lxc.cgroup2.devices.allow: c 226:1 rwm
lxc.cgroup2.devices.allow: c 226:128 rwm
lxc.cgroup2.devices.allow: c 511:0 rwm
lxc.mount.entry: /dev/dri/by-path/pci-0000:c1:00.0-card dev/dri/card0 none bind,optional,create=file
lxc.mount.entry: /dev/dri/by-path/pci-0000:c1:00.0-render dev/dri/renderD128 none bind,optional,create=file
lxc.mount.entry: /dev/kfd dev/kfd none bind,optional,create=file
lxc.mount.entry: /dev/fuse dev/fuse none bind,create=file 0 0
lxc.cgroup2.devices.allow: c 10:200 rwm
lxc.mount.entry: /dev/net/tun dev/net/tun none bind,create=file
lxc.cgroup2.devices.allow: c 10:223 rwm
lxc.mount.entry: /dev/uinput dev/uinput none bind,create=file 0 0
lxc.apparmor.profile: unconfined
lxc.cap.drop:
lxc.cgroup2.devices.allow: c 13:* rwm
lxc.mount.entry: /dev/input dev/input none bind,optional,create=dir
lxc.hook.pre-start: sh -c "chown 100000:111000 /dev/input"
lxc.cgroup2.devices.allow: c 10:223 rwm
lxc.mount.entry: /dev/uinput dev/uinput none bind,optional,create=file
lxc.cgroup2.devices.allow: c 10:239 rwm
lxc.mount.entry: /dev/uhid dev/uhid none bind,optional,create=file